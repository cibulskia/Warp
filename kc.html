<!doctype html>
<html lang="sr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Prikaz CSV iz Google Sheets</title>

  <!-- PapaParse za sigurno parsiranje CSV-a -->
  <script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js" defer></script>

  <style>
    :root{
      --bg: #0f172a;
      --card: #0b1220;
      --muted: #94a3b8;
      --accent: #06b6d4;
      --glass: rgba(255,255,255,0.03);
    }
    html,body{
      height:100%;
      margin:0;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg,var(--bg), #071026);
      color:#e6eef8;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      padding:24px;
      box-sizing:border-box;
    }

    header{
      display:flex;
      gap:12px;
      align-items:center;
      margin-bottom:18px;
    }
    header h1{
      margin:0;
      font-size:20px;
      letter-spacing:0.2px;
    }
    header p{ margin:0; color:var(--muted); font-size:13px; }

    .controls{
      margin-left:auto;
      display:flex;
      gap:8px;
      align-items:center;
    }
    .btn{
      background:var(--glass);
      border:1px solid rgba(255,255,255,0.04);
      padding:6px 10px;
      border-radius:10px;
      cursor:pointer;
      color:var(--muted);
      font-size:13px;
    }
    .btn:hover{ color:#fff; transform:translateY(-1px); }

    #status{
      color:var(--muted);
      font-size:13px;
      margin-bottom:12px;
    }

    .grid{
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap:12px;
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:12px;
      padding:12px;
      box-shadow: 0 6px 18px rgba(2,6,23,0.6);
      border: 1px solid rgba(255,255,255,0.03);
      min-height:60px;
      display:flex;
      flex-direction:column;
      gap:6px;
      word-wrap:break-word;
    }

    .meta{
      display:flex;
      gap:8px;
      align-items:center;
      font-size:12px;
      color:var(--muted);
    }
    .value{
      font-size:15px;
      color:#eaf6fb;
      white-space:pre-wrap;
      overflow-wrap: anywhere;
    }

    .header-row{
      font-weight:600;
      color:var(--accent);
      font-size:13px;
    }

    footer{
      margin-top:18px;
      color:var(--muted);
      font-size:13px;
    }

    /* responsive tweaks */
    @media (max-width:520px){
      .grid{ grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); }
    }
  </style>
</head>
<body>
  <header>
    <div>
      <h1>Prikaz podataka iz Google Sheet (CSV)</h1>
      <p id="sheet-url" style="color:var(--muted); font-size:13px; margin-top:6px;"></p>
    </div>

    <div class="controls">
      <button id="reloadBtn" class="btn" title="Ponovo učitaj CSV">↻ Reload</button>
      <button id="toggleHeaders" class="btn" title="Prikaži / sakrij zaglavlja"># Header</button>
    </div>
  </header>

  <div id="status">Učitavanje...</div>

  <main>
    <div class="grid" id="grid"></div>
  </main>

  <footer>
    <div id="metaInfo"></div>
  </footer>

  <script>
    // URL CSV koji je korisnik dao
    const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vToqj0JglDOwG_PdfpqiBTA76JnJO9AY38FNnpudB_YevYjhriY6oZbthJeUfqbkPbOdDxf8Aa4R9__/pub?gid=151805995&single=true&output=csv";

    // Elementi
    const statusEl = document.getElementById('status');
    const gridEl = document.getElementById('grid');
    const reloadBtn = document.getElementById('reloadBtn');
    const toggleHeadersBtn = document.getElementById('toggleHeaders');
    const sheetUrlEl = document.getElementById('sheet-url');
    const metaInfoEl = document.getElementById('metaInfo');

    let showHeaders = true;

    sheetUrlEl.textContent = CSV_URL;

    // Funkcija za učitavanje i prikaz CSV-a
    async function loadAndRender() {
      statusEl.textContent = "Učitavam CSV...";
      gridEl.innerHTML = "";
      metaInfoEl.textContent = "";

      try {
        const res = await fetch(CSV_URL, {cache: "no-store"});
        if (!res.ok) throw new Error("Greška pri preuzimanju CSV-a: " + res.status + " " + res.statusText);
        const text = await res.text();

        // Parse CSV preko PapaParse
        const parsed = Papa.parse(text, {
          delimiter: "", // auto-detect
          newline: "", // auto-detect
          header: false,
          skipEmptyLines: true,
        });

        if (parsed.errors && parsed.errors.length) {
          console.warn("CSV parse greške:", parsed.errors);
        }

        const rows = parsed.data; // niz nizova
        if (!rows || rows.length === 0) {
          statusEl.textContent = "CSV je prazan ili nevalidan.";
          return;
        }

        statusEl.textContent = `Pronađeno ${rows.length} redova. Prikazujem polja kao pojedinačne podatke.`;

        // Ako je prvi red zaglavlje, mozes ga koristiti kao labelu polja
        const firstRow = rows[0];
        let headerRow = null;
        // logika: ako su sva polja u prvom redu jedinstvena i ne-numerička, tretiraj kao header
        const uniqueCheck = new Set(firstRow.map(v => String(v).trim().toLowerCase()));
        if (uniqueCheck.size === firstRow.length) {
          headerRow = firstRow;
        }

        // Izbroji polja i prikaži metadata
        let totalFields = 0;
        for (const r of rows) totalFields += r.length;
        metaInfoEl.textContent = `Ukupno polja: ${totalFields} · Redova: ${rows.length}`;

        // Render: svaki cell -> svoj card
        // Počevši od prvog reda. Ako headerRow postoji i showHeaders==true, prikazujemo zaglavlja unutar kartice.
        // Ali prema zahtevu "jedno polje > jedan podatak", svaki cell dobija zaseban .card

        const fragment = document.createDocumentFragment();

        for (let r = 0; r < rows.length; r++) {
          const row = rows[r];
          for (let c = 0; c < row.length; c++) {
            const raw = row[c];
            const card = document.createElement('div');
            card.className = 'card';

            // meta linija: Red i Kolona
            const meta = document.createElement('div');
            meta.className = 'meta';
            const idx = document.createElement('div');
            idx.textContent = `red ${r+1} · polje ${c+1}`;
            meta.appendChild(idx);

            // ako imamo headerRow i showHeaders, pokažemo naziv kolone
            if (headerRow && showHeaders) {
              const hdr = document.createElement('div');
              hdr.className = 'header-row';
              hdr.textContent = headerRow[c] !== undefined ? headerRow[c] : `col ${c+1}`;
              meta.appendChild(hdr);
            }

            const val = document.createElement('div');
            val.className = 'value';
            val.textContent = raw;

            card.appendChild(meta);
            card.appendChild(val);
            fragment.appendChild(card);
          }
        }

        gridEl.appendChild(fragment);

      } catch (err) {
        console.error(err);
        statusEl.textContent = "Greška: " + (err.message || err);
      }
    }

    // Event listeners
    reloadBtn.addEventListener('click', () => {
      loadAndRender();
    });

    toggleHeadersBtn.addEventListener('click', () => {
      showHeaders = !showHeaders;
      toggleHeadersBtn.style.opacity = showHeaders ? 1 : 0.7;
      // re-render brzo (možeš optimizovati; radi jednostavnosti ponovo učitavamo)
      loadAndRender();
    });

    // Auto-load prilikom otvaranja
    window.addEventListener('load', () => {
      loadAndRender();
    });
  </script>
</body>
</html>
