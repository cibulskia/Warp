<!DOCTYPE html>
<html lang="sr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Google OAuth App sa PDF Listom</title>
<script src="https://accounts.google.com/gsi/client" async defer></script>
<style>
body{font-family:Arial,sans-serif;display:flex;justify-content:center;align-items:flex-start;min-height:100vh;background-color:#f4f4f4;margin:0;padding:20px}
.container{background-color:#fff;padding:30px;border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,0.1);text-align:center;width:800px}
h1{color:#333;margin-bottom:20px}
input[type="text"]{width:calc(100% - 22px);padding:10px;margin-bottom:12px;border:1px solid #ddd;border-radius:4px;font-size:16px}
button{background-color:#007bff;color:white;padding:10px 15px;border:none;border-radius:4px;cursor:pointer;font-size:16px;margin:5px}
button:hover{background-color:#0056b3}
#message{margin-top:14px;color:#333}
#user-name{font-weight:bold;color:#007bff}
#signout-button{background-color:#dc3545}
#signout-button:hover{background-color:#c82333}
.profile-img{width:120px;height:120px;border-radius:999px;object-fit:cover;border:2px solid #eee;margin:10px 0}
.file-row{display:flex;gap:8px;align-items:center;justify-content:center;margin-top:10px}
.small{font-size:14px}
.pdf-list{margin-top:20px;text-align:left}
.pdf-list li{margin-bottom:8px;cursor:pointer;color:#007bff}
.pdf-list li:hover{color:#0056b3;text-decoration:underline}
.pdf-preview{margin-top:20px;text-align:center}
.pdf-preview iframe{width:100%;height:500px;border:1px solid #ccc;border-radius:4px;display:none}
</style>
</head>
<body>
<div class="container">
<h1>Moja Aplikacija</h1>

<!-- Google Sign-In -->
<div id="g_id_onload"
data-client_id="252373158568-4up41b7jo8ik6cu8c1pl3mlvvck2sq2t.apps.googleusercontent.com"
data-auto_select="true"
data-callback="handleCredentialResponse"
data-ux_mode="popup"
data-cancel_on_tap_outside="false"
data-context="use">
</div>
<div class="g_id_signin"
data-type="standard"
data-size="large"
data-theme="outline"
data-text="sign_in_with"
data-shape="rectangular"
data-logo_alignment="left">
</div>

<!-- App Content -->
<div id="app-content" style="display:none">
<p>Dobrodošao, <span id="user-name"></span>!</p>
<img id="profile-image" class="profile-img" src="" alt="Profilna slika" style="display:none"/>
<div>
<input type="text" id="data-input" placeholder="Unesi tekst ovde..." />
</div>
<div style="margin-top:8px">
<button id="save-button">Sačuvaj Podatke</button>
<button id="load-button">Učitaj Podatke</button>
</div>
<div class="file-row">
<input type="file" id="image-file" accept="image/*"/>
<button id="upload-button">Otpremi Profilnu</button>
</div>

<!-- Lista PDF-a -->
<div class="pdf-list-container">
  <h3>Lista PDF-a:</h3>
  <ul id="pdf-list"></ul>
</div>

<!-- PDF Preview -->
<div class="pdf-preview">
  <iframe id="pdf-frame"></iframe>
</div>

<p id="message"></p>
<button id="signout-button">Odjavi se</button>
</div>
</div>

<script>
const BACKEND_URL = 'https://botanica.ngrok.app';
let googleIdToken = null;
let userName = null;

// Primer JSON sa PDF-ovima
const pdfFiles = [
  {
    "title": "Moj PDF Dokument",
    "url": "https://drive.google.com/file/d/1BDLbI7OPxGrc2cy4etBjsCdyRoKUjUoI/preview",
    "download_url": "https://drive.google.com/uc?export=download&id=1BDLbI7OPxGrc2cy4etBjsCdyRoKUjUoI"
  },
  {
    "title": "Drugi PDF Primer",
    "url": "https://drive.google.com/file/d/1-example-pdf/preview",
    "download_url": "https://drive.google.com/uc?export=download&id=1-example-pdf"
  }
];

// Funkcija za prikaz liste PDF-a
function renderPdfList(){
  const listEl = document.getElementById('pdf-list');
  listEl.innerHTML = '';
  pdfFiles.forEach((pdf, index)=>{
    const li = document.createElement('li');
    li.textContent = pdf.title;
    li.addEventListener('click', ()=>{
      const frame = document.getElementById('pdf-frame');
      frame.src = pdf.url;
      frame.style.display = 'block';
    });
    listEl.appendChild(li);
  });
}

// Google OAuth
function handleCredentialResponse(response){
  googleIdToken = response.credential;
  fetch(`${BACKEND_URL}/verify-google-login`,{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({id_token:googleIdToken})
  })
  .then(res=>res.json())
  .then(data=>{
    if(data.status==='success'){
      userName=data.user_name;
      updateUIForLoggedInUser();
    } else {
      googleIdToken=null;userName=null;
      updateUIForLoggedOutUser();
      alert('Login failed: '+(data.message||''));
    }
  })
  .catch(err=>{
    googleIdToken=null;userName=null;
    updateUIForLoggedOutUser();
    alert('Greška pri prijavi');
  });
}

function updateUIForLoggedInUser(){
  document.getElementById('g_id_onload').style.display='none';
  document.querySelector('.g_id_signin').style.display='none';
  document.getElementById('app-content').style.display='block';
  document.getElementById('user-name').textContent=userName||'';
  document.getElementById('message').textContent='';
  document.getElementById('data-input').value='';
  document.getElementById('profile-image').style.display='none';
  document.getElementById('profile-image').src='';
  renderPdfList();
}

function updateUIForLoggedOutUser(){
  document.getElementById('g_id_onload').style.display='block';
  document.querySelector('.g_id_signin').style.display='block';
  document.getElementById('app-content').style.display='none';
  document.getElementById('user-name').textContent='';
  document.getElementById('message').textContent='Molimo prijavite se putem Google-a.';
  googleIdToken=null;userName=null;
  document.cookie = "session=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
}

window.onload=function(){updateUIForLoggedOutUser()};

// Ostale funkcije za save/load/upload/signout ostaju iste kao u originalnom kodu...
</script>
</body>
</html>
