<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Google OAuth App with Profile</title>
<script src="https://accounts.google.com/gsi/client" async defer></script>
<style>
body{font-family:Arial,sans-serif;display:flex;justify-content:center;align-items:center;min-height:100vh;background:#f4f4f4;margin:0}.container{background:#fff;padding:30px;border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,0.1);text-align:center;width:400px}h1{color:#333;margin-bottom:20px}input[type=text]{width:calc(100% - 20px);padding:10px;margin-bottom:15px;border:1px solid #ddd;border-radius:4px;font-size:16px}button{background:#007bff;color:#fff;padding:10px 15px;border:none;border-radius:4px;cursor:pointer;font-size:16px;margin:5px}button:hover{background:#0056b3}#message{margin-top:20px;color:#333}#user-name{font-weight:bold;color:#007bff}#signout-button{background:#dc3545}#signout-button:hover{background:#c82333}#profile-img{width:100px;height:100px;border-radius:50%;object-fit:cover;margin-bottom:15px}
</style>
</head>
<body>
<div class="container">
<h1>Moja Aplikacija</h1>
<div id="g_id_onload" data-client_id="252373158568-4up41b7jo8ik6cu8c1pl3mlvvck2sq2t.apps.googleusercontent.com" data-auto_select="true" data-callback="handleCredentialResponse" data-ux_mode="popup" data-cancel_on_tap_outside="false" data-context="use"></div>
<div class="g_id_signin" data-type="standard" data-size="large" data-theme="outline" data-text="sign_in_with" data-shape="rectangular" data-logo_alignment="left"></div>
<div id="app-content" style="display:none;">
<p>Dobrodošao, <span id="user-name"></span>!</p>
<img id="profile-img" src="" alt="Profilna slika">
<input type="file" id="profile-upload">
<input type="text" id="data-input" placeholder="Unesi tekst ovde...">
<button id="save-button">Sačuvaj Podatke</button>
<button id="load-button">Učitaj Podatke</button>
<p id="message"></p>
<button id="signout-button">Odjavi se</button>
</div>
</div>
<script>
const BACKEND_URL='https://botanica.ngrok.app';
let googleIdToken=null;
let userName=null;
let userId=null;
function handleCredentialResponse(response){
googleIdToken=response.credential;
fetch(`${BACKEND_URL}/verify-google-login`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({id_token:googleIdToken})}).then(r=>{if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return r.json()}).then(data=>{if(data.status==='success'){userName=data.user_name;userId=data.google_id;updateUIForLoggedInUser();document.getElementById('profile-img').src=data.profile_img||''}else{googleIdToken=null;userName=null;userId=null;updateUIForLoggedOutUser();alert(data.message)}}).catch(e=>{googleIdToken=null;userName=null;userId=null;updateUIForLoggedOutUser();alert("An error occurred during login. Please try again.")})}
function updateUIForLoggedInUser(){
document.getElementById('g_id_onload').style.display='none';
document.querySelector('.g_id_signin').style.display='none';
document.getElementById('app-content').style.display='block';
document.getElementById('user-name').textContent=userName;
document.getElementById('message').textContent='';
document.getElementById('data-input').value='';
}
function updateUIForLoggedOutUser(){
document.getElementById('g_id_onload').style.display='block';
document.querySelector('.g_id_signin').style.display='block';
document.getElementById('app-content').style.display='none';
document.getElementById('user-name').textContent='';
document.getElementById('message').textContent='Molimo prijavite se putem Google-a.';
googleIdToken=null;
userName=null;
userId=null;
document.cookie="session=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
}
window.onload=function(){updateUIForLoggedOutUser()};
document.getElementById('save-button').addEventListener('click',()=>{
const textData=document.getElementById('data-input').value;
if(!googleIdToken){alert("Niste prijavljeni. Molimo prijavite se putem Google-a.");return}
fetch(`${BACKEND_URL}/save-data`,{method:'POST',headers:{'Content-Type':'application/json','Authorization':`Bearer ${googleIdToken}`},body:JSON.stringify({data:textData})}).then(r=>{if(!r.ok){if(r.status===401){alert("Vaša sesija je istekla. Molimo prijavite se ponovo.");updateUIForLoggedOutUser()}throw new Error(`HTTP error! status: ${r.status}`)}return r.json()}).then(d=>{document.getElementById('message').textContent=d.message}).catch(e=>{document.getElementById('message').textContent="Greška prilikom čuvanja podataka."})});
document.getElementById('load-button').addEventListener('click',()=>{
if(!googleIdToken){alert("Niste prijavljeni. Molimo prijavite se putem Google-a.");return}
fetch(`${BACKEND_URL}/load-data`,{method:'GET',headers:{'Authorization':`Bearer ${googleIdToken}`}}).then(r=>{if(!r.ok){if(r.status===401){alert("Vaša sesija je istekla. Molimo prijavite se ponovo.");updateUIForLoggedOutUser()}throw new Error(`HTTP error! status: ${r.status}`)}return r.json()}).then(d=>{document.getElementById('data-input').value=d.data||'';document.getElementById('message').textContent=d.message}).catch(e=>{document.getElementById('message').textContent="Greška prilikom učitavanja podataka."})});
document.getElementById('signout-button').addEventListener('click',()=>{
googleIdToken=null;
userName=null;
userId=null;
updateUIForLoggedOutUser();
fetch(`${BACKEND_URL}/logout`,{method:'POST',headers:{'Content-Type':'application/json'}}).then(r=>r.json()).then(d=>alert("Uspešno ste se odjavili.")).catch(e=>alert("Došlo je do greške prilikom odjave sa servera."))});
document.getElementById('profile-upload').addEventListener('change',e=>{
const file=e.target.files[0];
if(!file){return}
const formData=new FormData();
formData.append('profile_image',file);
fetch(`${BACKEND_URL}/upload-profile`,{method:'POST',headers:{'Authorization':`Bearer ${googleIdToken}`},body:formData}).then(r=>r.json()).then(d=>{if(d.status==='success'){document.getElementById('profile-img').src=d.profile_img;document.getElementById('message').textContent=d.message}else{alert(d.message)}}).catch(err=>{console.error(err);alert("Greška pri uploadu slike.")})});
</script>
</body>
</html>
